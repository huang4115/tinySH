/************************************************************************************
 *  Copyright (c), 2009 -  , XXXX软件有限公司
 *            All rights reserved.
 *
 * File name: spin_lock.h
 * Project  : STM32F10X
 * Processor: STM32F10X
 * Compiler : ARM Compiler
 * 
 * Author : 李春君
 * Version: 1.00
 * Date   : 2011.3.24 
 * Email  : hevake_lcj@126.com
 * Modification: none
 * 
 * Description: 
 *   自旋锁函数 
 *
 * Others: none;
 *      	
 * Function List: 
 *	 1. U8		Spin_Lock( U16 *lock , U16 mask , U32 time_out );
 *   2. void	Spin_Unlock( U16 *lock , U16 mask );
 *   
 * History:
 *   1. Author:       none  
 *	    Version: 	  0.0
 *	    Date:         2011.XX.XX
 *      Modification: none
 *
 * Note:
 *     自旋锁只能运用于短暂的资源抢占，资源占用时长不应大于10ms。否则CPU资源占用较大
 *
 ************************************************************************************
 */

#ifndef	__SPIN_LOCK_H__
#define	__SPIN_LOCK_H__

/**
 ====================================================================================
 |  							   文  件  包  含									|
 |																					|
 |  NOTE: 																			|
 ====================================================================================
 */
#include "type.h"

/**
 ====================================================================================
 |  							   宏    定    义									|
 |																					|
 |  NOTE: 																			|
 ====================================================================================
 */

/**
 ====================================================================================
 |  							  变 量 类 型 定 义									|
 |																					|
 |  NOTE: 																			|
 ====================================================================================
 */
typedef	volatile U8    slock_t;

/**
 ====================================================================================
 |  							   变  量  声  明									|
 |																					|
 |  NOTE: 																			|
 ====================================================================================
 */

/**
 ====================================================================================
 |  							   函  数  声  明									|
 |																					|
 |  NOTE: 																			|
 ====================================================================================
 */

/**
 ***********************************************************************************
 * Function: Spin_Lock;
 *
 * Description: 自旋锁上锁;
 *           
 * Input: 	--lock	锁变量
 *			--mask	锁掩码
 *          --time_out	超时时间
 *
 * Output:	none;
 *          		
 * Return:	U8	状态
 *              0：正常退出
 *              1：超时退出
 *
 * Note: 	time_out=0时表示永久等待，最长延时65.535秒
 ***********************************************************************************
 */
U8	Spin_Lock( slock_t *lock , slock_t mask , U16 time_out );

/**
 ***********************************************************************************
 * Function: Spin_Unlock;
 *
 * Description: 自旋锁解锁;
 *           
 * Input: 	--lock	锁变量
 *			--mask	锁掩码
 *
 * Output:	none;
 *          		
 * Return:	none;
 *
 * Note: 
 ***********************************************************************************
 */
void	Spin_Unlock( slock_t *lock , slock_t mask );

#endif	//__SPIN_LOCK_H__

/**
 ====================================================================================
 |  							   文  件  结  束  									|
 ====================================================================================
 */

